services:
  # Dienst 1: Der NonPlusUltra Bot (Hintergrund-Dienst)
  - type: worker
    name: nonplusultra-bot
    env: python
    buildCommand: "pip install -r requirements.txt"
    startCommand: "python main.py" # We no longer need to start Redis here
    envVars:
      - key: PYTHON_VERSION
        value: 3.12.1
      - fromGroup: nonplusultra-secrets
      - key: REDIS_URL # This will be automatically provided by the Redis service below
        fromService:
          type: redis
          name: bot-redis
          property: connectionString

  # Dienst 2: Eine dedizierte Redis-Instanz für die Hot Watchlist
  - type: redis
    name: bot-redis
    plan: free # Use the free Redis plan to start
    maxmemoryPolicy: allkeys-lfu

# Umgebungsvariablen-Gruppe für alle Dienste
envVarGroups:
  - name: nonplusultra-secrets
    envVars:
      - key: QUICKNODE_RPC_URL
        sync: false
      - key: QUICKNODE_WSS_URL # This is no longer used but we keep it for now
        sync: false
      - key: TELEGRAM_BOT_TOKEN
        sync: false
      - key: TELEGRAM_CHAT_ID
        sync: false
      - key: GOOGLE_CLOUD_PROJECT
        sync: false
      - key: UPSTASH_REDIS_URL
        sync: false
      - key: GOOGLE_APPLICATION_CREDENTIALS_JSON
        sync: false