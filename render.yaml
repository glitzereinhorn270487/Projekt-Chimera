services:
  # Dienst 1: Der NonPlusUltra Bot (Hintergrund-Dienst)
  - type: worker
    name: nonplusultra-bot
    env: python
    buildCommand: "pip install -r requirements.txt"
    startCommand: "python main.py"
    envVars:
      - key: PYTHON_VERSION
        value: 3.12.1
      - fromGroup: nonplusultra-secrets
      - key: REDIS_URL
        fromService:
          type: redis
          name: bot-redis
          property: connectionString

  # Dienst 2: Eine dedizierte Redis-Instanz für die Hot Watchlist
  - type: redis
    name: bot-redis
    plan: free
    ipAllowList: # <-- THIS IS THE FIX
      - cidr: 0.0.0.0/0
        description: "Allow all internal"
    maxmemoryPolicy: allkeys-lfu

# Umgebungsvariablen-Gruppe für alle Dienste
envVarGroups:
  - name: nonplusultra-secrets
    envVars:
      - key: QUICKNODE_RPC_URL
        sync: false
      - key: QUICKNODE_WSS_URL
        sync: false
      - key: TELEGRAM_BOT_TOKEN
        sync: false
      - key: TELEGRAM_CHAT_ID
        sync: false
      - key: GOOGLE_CLOUD_PROJECT
        sync: false
      - key: UPSTASH_REDIS_URL
        sync: false
      - key: GOOGLE_APPLICATION_CREDENTIALS_JSON
        sync: false
